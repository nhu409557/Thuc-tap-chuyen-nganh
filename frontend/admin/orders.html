<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω ƒê∆°n h√†ng - TechHub Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-sans antialiased">

    <div class="p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Qu·∫£n l√Ω ƒê∆°n h√†ng</h1>
                <p class="text-sm text-gray-500">Theo d√µi v√† x·ª≠ l√Ω ƒë∆°n ƒë·∫∑t h√†ng</p>
            </div>
            <button onclick="openCreateOrderModal()" class="bg-blue-600 text-white px-5 py-2.5 rounded-xl hover:bg-blue-700 flex items-center gap-2 shadow-lg shadow-blue-500/30 transition-all">
                <i class="fa-solid fa-plus"></i> T·∫°o ƒë∆°n h√†ng
            </button>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6 flex flex-col sm:flex-row gap-4">
            <div class="relative flex-1">
                <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input type="text" id="search-input" placeholder="T√¨m m√£ ƒë∆°n, t√™n kh√°ch, SƒêT..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg outline-none text-sm">
            </div>
            <div class="w-full sm:w-48">
                <select id="status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg outline-none text-sm bg-white">
                    <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="Pending">Ch·ªù x√°c nh·∫≠n</option>
                    <option value="Confirmed">ƒê√£ x√°c nh·∫≠n</option>
                    <option value="Shipping">ƒêang giao h√†ng</option>
                    <option value="Delivered">Giao th√†nh c√¥ng</option>
                    <option value="Cancelled">ƒê√£ h·ªßy</option>
                </select>
            </div>
            <button onclick="loadOrders()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition">
                <i class="fa-solid fa-filter"></i> L·ªçc
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 border-b border-gray-200 text-gray-500 font-semibold uppercase text-xs">
                        <tr>
                            <th class="px-6 py-4">M√£ ƒë∆°n</th>
                            <th class="px-6 py-4">Kh√°ch h√†ng</th>
                            <th class="px-6 py-4">Ng√†y ƒë·∫∑t</th>
                            <th class="px-6 py-4">T·ªïng ti·ªÅn</th>
                            <th class="px-6 py-4">TT Thanh to√°n</th>
                            <th class="px-6 py-4">Tr·∫°ng th√°i ƒë∆°n</th>
                            <th class="px-6 py-4 text-right">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="orders-list" class="divide-y divide-gray-100">
                        <tr><td colspan="7" class="text-center py-8 text-gray-500">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center bg-gray-50">
                <button id="btn-prev" class="px-3 py-1 border rounded bg-white hover:bg-gray-50 disabled:opacity-50" disabled>Tr∆∞·ªõc</button>
                <span class="text-xs text-gray-500" id="page-info">Trang 1</span>
                <button id="btn-next" class="px-3 py-1 border rounded bg-white hover:bg-gray-50 disabled:opacity-50" disabled>Sau</button>
            </div>
        </div>
    </div>

    <div id="order-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[600px] bg-white shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="modal-panel">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                <div>
                    <h3 class="text-lg font-bold text-gray-800">Chi ti·∫øt ƒë∆°n h√†ng <span id="modal-order-id" class="text-blue-600">#...</span></h3>
                    <p class="text-xs text-gray-500" id="modal-order-date">...</p>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-white">
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-100 space-y-3">
                    <h4 class="font-bold text-blue-800 text-sm uppercase">C·∫≠p nh·∫≠t tr·∫°ng th√°i</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-gray-600 mb-1">Quy tr√¨nh ƒë∆°n h√†ng</label>
                            <select id="edit-status" class="w-full px-3 py-2 border rounded text-sm bg-white">
                                <option value="Pending">Ch·ªù x√°c nh·∫≠n</option>
                                <option value="Confirmed">ƒê√£ x√°c nh·∫≠n</option>
                                <option value="Shipping">ƒêang giao h√†ng</option>
                                <option value="Delivered">Giao th√†nh c√¥ng</option>
                                <option value="Cancelled">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600 mb-1">Thanh to√°n</label>
                            <select id="edit-payment-status" class="w-full px-3 py-2 border rounded text-sm bg-white">
                                <option value="Unpaid">Ch∆∞a thanh to√°n</option>
                                <option value="Paid">ƒê√£ thanh to√°n</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="updateOrderStatus()" class="w-full bg-blue-600 text-white py-2 rounded text-sm font-bold hover:bg-blue-700 transition shadow-sm">C·∫≠p nh·∫≠t thay ƒë·ªïi</button>
                </div>
                <div class="border-t border-gray-100 pt-4">
                    <h4 class="font-bold text-gray-800 text-sm mb-3"><i class="fa-regular fa-user"></i> Th√¥ng tin giao h√†ng</h4>
                    <div class="text-sm text-gray-600 space-y-1 ml-6">
                        <p><span class="font-semibold text-gray-900 w-20 inline-block">Ng∆∞·ªùi nh·∫≠n:</span> <span id="modal-name">...</span></p>
                        <p><span class="font-semibold text-gray-900 w-20 inline-block">SƒêT:</span> <span id="modal-phone">...</span></p>
                        <p><span class="font-semibold text-gray-900 w-20 inline-block">ƒê·ªãa ch·ªâ:</span> <span id="modal-address">...</span></p>
                        <p><span class="font-semibold text-gray-900 w-20 inline-block">Ph∆∞∆°ng th·ª©c:</span> <span id="modal-method" class="uppercase font-bold text-blue-600">...</span></p>
                    </div>
                </div>
                <div class="border-t border-gray-100 pt-4">
                    <h4 class="font-bold text-gray-800 text-sm mb-3"><i class="fa-solid fa-box-open"></i> S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</h4>
                    <div id="modal-items" class="space-y-3"></div>
                </div>
                <div class="border-t border-gray-200 pt-4 flex justify-between items-center">
                    <span class="font-bold text-gray-800">T·ªïng thanh to√°n</span>
                    <span class="font-bold text-xl text-red-600" id="modal-total">...</span>
                </div>
            </div>
        </div>
    </div>

    <div id="create-order-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeCreateOrderModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl w-full max-w-4xl p-0 flex flex-col max-h-[90vh]">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl">
                <h3 class="text-lg font-bold text-gray-800">T·∫°o ƒë∆°n h√†ng m·ªõi</h3>
                <button onclick="closeCreateOrderModal()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h4 class="font-bold text-gray-800 border-b pb-2">1. Th√¥ng tin kh√°ch h√†ng</h4>
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">H·ªç v√† t√™n</label><input type="text" id="new-order-name" class="w-full px-3 py-2 border rounded text-sm outline-none focus:border-blue-500"></div>
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">S·ªë ƒëi·ªán tho·∫°i</label><input type="text" id="new-order-phone" class="w-full px-3 py-2 border rounded text-sm outline-none focus:border-blue-500"></div>
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">ƒê·ªãa ch·ªâ giao h√†ng</label><textarea id="new-order-address" rows="3" class="w-full px-3 py-2 border rounded text-sm outline-none focus:border-blue-500"></textarea></div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
                        <select id="new-order-payment" class="w-full px-3 py-2 border rounded text-sm outline-none bg-white">
                            <option value="cod">COD (Ti·ªÅn m·∫∑t)</option>
                            <option value="banking">Chuy·ªÉn kho·∫£n</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-4 flex flex-col">
                    <h4 class="font-bold text-gray-800 border-b pb-2">2. S·∫£n ph·∫©m</h4>
                    <div class="relative">
                        <input type="text" id="product-search" placeholder="T√¨m s·∫£n ph·∫©m..." class="w-full pl-3 pr-10 py-2 border rounded text-sm outline-none focus:border-blue-500">
                        <button class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"><i class="fa-solid fa-search"></i></button>
                        <div id="product-suggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 shadow-lg rounded-b-lg mt-1 max-h-48 overflow-y-auto z-10 hidden"></div>
                    </div>
                    <div class="flex-1 bg-gray-50 border border-gray-200 rounded-lg p-3 overflow-y-auto max-h-60" id="selected-products-list">
                        <p class="text-center text-gray-400 text-xs py-4">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</p>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-gray-200">
                        <span class="font-bold text-gray-800">T·ªïng c·ªông:</span>
                        <span class="font-bold text-xl text-blue-600" id="new-order-total">0 ‚Ç´</span>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end gap-3">
                <button onclick="closeCreateOrderModal()" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100">H·ªßy</button>
                <button onclick="submitCreateOrder()" class="px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 shadow-md flex items-center gap-2">
                    <i class="fa-solid fa-paper-plane"></i> T·∫°o ƒë∆°n
                </button>
            </div>
        </div>
    </div>

    <div id="toast-root"></div>

    <script type="module">
        // üëá Import t·ª´ admin.js ƒë·ªÉ render Layout
        import { renderAdminLayout, formatPrice } from '../assets/js/admin.js';
        import { api } from '../assets/js/api.js';
        import { showToast } from '../assets/js/ui/toast.js';

        renderAdminLayout('orders');

        let currentPage = 1;
        let currentOrderId = null;
        let selectedProducts = []; 

        const STATUS_COLORS = {
            'Pending': 'bg-yellow-100 text-yellow-700 border-yellow-200',
            'Confirmed': 'bg-blue-100 text-blue-700 border-blue-200',
            'Shipping': 'bg-indigo-100 text-indigo-700 border-indigo-200',
            'Delivered': 'bg-green-100 text-green-700 border-green-200',
            'Cancelled': 'bg-red-100 text-red-700 border-red-200'
        };

        window.loadOrders = async (page = 1) => {
            const q = document.getElementById('search-input').value;
            const status = document.getElementById('status-filter').value;
            currentPage = page;

            try {
                document.getElementById('orders-list').innerHTML = `<tr><td colspan="7" class="text-center py-8 text-gray-500">ƒêang t·∫£i...</td></tr>`;
                
                const res = await api.getOrdersAdmin({ q, status, page });
                const orders = res.data || res.items || [];
                const totalPage = res.total_page || 1;

                if (orders.length === 0) {
                    document.getElementById('orders-list').innerHTML = `<tr><td colspan="7" class="text-center py-8 text-gray-500 italic">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o.</td></tr>`;
                    updatePagination(0, 0);
                    return;
                }

                const html = orders.map(o => {
                    const isPaid = o.payment_status === 'Paid';
                    const payBadge = isPaid 
                        ? `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-bold bg-green-50 text-green-600 border border-green-200 uppercase">ƒê√£ TT</span>`
                        : `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-bold bg-gray-50 text-gray-500 border border-gray-200 uppercase">Ch∆∞a TT</span>`;
                    const statusClass = STATUS_COLORS[o.status] || 'bg-gray-100 text-gray-600';

                    return `
                    <tr class="hover:bg-blue-50/30 transition border-b border-gray-50">
                        <td class="px-6 py-4 font-medium text-blue-600">#${o.id}</td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${o.name}</div>
                            <div class="text-xs text-gray-400">${o.phone}</div>
                        </td>
                        <td class="px-6 py-4 text-gray-500 text-xs">${new Date(o.created_at).toLocaleDateString('vi-VN')}</td>
                        <td class="px-6 py-4 font-bold text-gray-900">${formatPrice(o.total_amount)}</td>
                        <td class="px-6 py-4"><div class="flex flex-col gap-1"><span class="text-xs font-bold text-gray-500 uppercase">${o.payment_method}</span>${payBadge}</div></td>
                        <td class="px-6 py-4"><span class="px-2.5 py-1 rounded-full text-xs font-medium border ${statusClass}">${o.status}</span></td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="viewOrder(${o.id})" class="bg-white border border-gray-200 text-gray-600 hover:text-blue-600 hover:border-blue-300 px-3 py-1.5 rounded-lg text-xs font-medium transition shadow-sm">Chi ti·∫øt</button>
                        </td>
                    </tr>`;
                }).join('');

                document.getElementById('orders-list').innerHTML = html;
                updatePagination(page, totalPage);
            } catch (e) {
                console.error(e);
                showToast('L·ªói t·∫£i d·ªØ li·ªáu', 'error');
            }
        }

        function updatePagination(page, total) {
            document.getElementById('page-info').innerText = `Trang ${page} / ${total}`;
            document.getElementById('btn-prev').disabled = page <= 1;
            document.getElementById('btn-next').disabled = page >= total;
            document.getElementById('btn-prev').onclick = () => loadOrders(page - 1);
            document.getElementById('btn-next').onclick = () => loadOrders(page + 1);
        }

        window.viewOrder = async (id) => {
            currentOrderId = id;
            const modal = document.getElementById('order-modal');
            const panel = document.getElementById('modal-panel');
            
            try {
                const order = await api.getOrderAdmin(id);
                document.getElementById('modal-order-id').innerText = '#' + order.id;
                document.getElementById('modal-order-date').innerText = new Date(order.created_at).toLocaleString('vi-VN');
                document.getElementById('modal-name').innerText = order.name;
                document.getElementById('modal-phone').innerText = order.phone;
                document.getElementById('modal-address').innerText = order.address;
                document.getElementById('modal-method').innerText = order.payment_method;
                document.getElementById('modal-total').innerText = formatPrice(order.total_amount);
                document.getElementById('edit-status').value = order.status;
                document.getElementById('edit-payment-status').value = order.payment_status || 'Unpaid';

                const itemsHtml = (order.items || []).map(item => `
                    <div class="flex gap-3 py-2 border-b border-gray-50 last:border-0">
                        <img src="${item.product_image || 'https://via.placeholder.com/50'}" class="w-12 h-12 rounded border object-cover">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800 line-clamp-2">${item.product_title}</p>
                            <div class="flex justify-between mt-1 text-xs">
                                <span class="text-gray-500">x${item.quantity}</span>
                                <span class="font-semibold text-blue-600">${formatPrice(item.price)}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('modal-items').innerHTML = itemsHtml;

                modal.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } catch (e) { showToast('Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt', 'error'); }
        }

        window.closeModal = () => {
            document.getElementById('modal-panel').classList.add('translate-x-full');
            setTimeout(() => document.getElementById('order-modal').classList.add('hidden'), 300);
        }

        window.updateOrderStatus = async () => {
            if (!currentOrderId) return;
            const status = document.getElementById('edit-status').value;
            const payStatus = document.getElementById('edit-payment-status').value;
            try {
                await api.updateOrderAdmin(currentOrderId, { status: status, payment_status: payStatus });
                showToast('C·∫≠p nh·∫≠t th√†nh c√¥ng', 'success');
                loadOrders(currentPage);
            } catch (e) { showToast('L·ªói c·∫≠p nh·∫≠t', 'error'); }
        }

        window.openCreateOrderModal = () => {
            document.getElementById('create-order-modal').classList.remove('hidden');
            selectedProducts = [];
            renderSelectedProducts();
            document.getElementById('new-order-name').value = '';
            document.getElementById('new-order-phone').value = '';
            document.getElementById('new-order-address').value = '';
            document.getElementById('product-search').value = '';
        }

        window.closeCreateOrderModal = () => document.getElementById('create-order-modal').classList.add('hidden');

        let searchTimer;
        document.getElementById('product-search').addEventListener('input', (e) => {
            clearTimeout(searchTimer);
            const query = e.target.value.trim();
            const suggestionsBox = document.getElementById('product-suggestions');
            
            if (!query) { suggestionsBox.classList.add('hidden'); return; }

            searchTimer = setTimeout(async () => {
                try {
                    const res = await api.getProducts({ q: query });
                    const products = res.data || res.items || [];
                    
                    if (products.length === 0) {
                        suggestionsBox.innerHTML = `<div class="p-3 text-sm text-gray-500">Kh√¥ng t√¨m th·∫•y.</div>`;
                    } else {
                        suggestionsBox.innerHTML = products.map(p => `
                            <div class="flex items-center gap-3 p-2 hover:bg-gray-100 cursor-pointer border-b last:border-0"
                                 onclick='window.addToOrder(${JSON.stringify(p).replace(/'/g, "&#39;")})'>
                                <img src="${p.image}" class="w-10 h-10 object-cover rounded border">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-800 line-clamp-1">${p.title}</p>
                                    <p class="text-xs text-blue-600 font-bold">${formatPrice(p.price)}</p>
                                </div>
                                <button class="text-blue-600 text-xs font-bold bg-blue-50 px-2 py-1 rounded"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        `).join('');
                    }
                    suggestionsBox.classList.remove('hidden');
                } catch (e) { console.error(e); }
            }, 300);
        });

        window.addToOrder = (product) => {
            const existing = selectedProducts.find(p => p.id === product.id);
            if (existing) existing.quantity += 1;
            else selectedProducts.push({ ...product, quantity: 1 });
            
            document.getElementById('product-suggestions').classList.add('hidden');
            document.getElementById('product-search').value = '';
            renderSelectedProducts();
        };

        window.removeFromOrder = (id) => {
            selectedProducts = selectedProducts.filter(p => p.id !== id);
            renderSelectedProducts();
        };

        window.changeOrderQty = (id, delta) => {
            const item = selectedProducts.find(p => p.id === id);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) window.removeFromOrder(id);
                else renderSelectedProducts();
            }
        };

        function renderSelectedProducts() {
            const container = document.getElementById('selected-products-list');
            const totalEl = document.getElementById('new-order-total');
            
            if (selectedProducts.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-400 text-xs py-4">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</p>`;
                totalEl.innerText = '0 ‚Ç´';
                return;
            }

            let total = 0;
            container.innerHTML = selectedProducts.map(p => {
                const lineTotal = p.price * p.quantity;
                total += lineTotal;
                return `
                <div class="flex items-center justify-between bg-white p-2 rounded border mb-2 text-sm">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <img src="${p.image}" class="w-8 h-8 object-cover rounded">
                        <div class="min-w-0">
                            <p class="font-medium truncate w-32">${p.title}</p>
                            <p class="text-xs text-gray-500">${formatPrice(p.price)}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="flex items-center border rounded">
                            <button onclick="changeOrderQty(${p.id}, -1)" class="px-2 py-0.5 hover:bg-gray-100 text-gray-600">-</button>
                            <span class="px-2 text-xs font-bold">${p.quantity}</span>
                            <button onclick="changeOrderQty(${p.id}, 1)" class="px-2 py-0.5 hover:bg-gray-100 text-gray-600">+</button>
                        </div>
                        <button onclick="removeFromOrder(${p.id})" class="text-red-500 hover:text-red-700 px-1"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
            totalEl.innerText = formatPrice(total);
        }

        window.submitCreateOrder = async () => {
            const name = document.getElementById('new-order-name').value.trim();
            const phone = document.getElementById('new-order-phone').value.trim();
            const address = document.getElementById('new-order-address').value.trim();
            const paymentMethod = document.getElementById('new-order-payment').value;

            if (!name || !phone || !address) { showToast('Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin', 'error'); return; }
            if (selectedProducts.length === 0) { showToast('Ch∆∞a ch·ªçn s·∫£n ph·∫©m', 'error'); return; }

            const payload = {
                name, phone, address, payment_method: paymentMethod,
                items: selectedProducts.map(p => ({ 
                    product_id: p.id, 
                    title: p.title, 
                    price: p.price, 
                    quantity: p.quantity 
                }))
            };

            try {
                await api.createOrder(payload);
                showToast('T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng!', 'success');
                closeCreateOrderModal();
                loadOrders();
            } catch (e) {
                console.error(e);
                showToast('L·ªói: ' + e.message, 'error');
            }
        }

        loadOrders();
    </script>
</body>
</html>